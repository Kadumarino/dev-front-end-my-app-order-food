<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#7cb342">
  <title>üçî Kadu Lanches - Pagamento</title>
  <link rel="stylesheet" href="estilizacao-lanche.css">
</head>
<body>
  <header>
    <h1>üçî Kadu Lanches</h1>
    <p>Forma de Pagamento</p>
    <button id="back-home">&lt;</button>
  </header>

  <section class="pre-cadastro-section">
    <h2>Escolha e preencha os dados</h2>
    <form id="payment-form">
      <label><input type="checkbox" name="payment-option" value="pix"> Pix (chave aleat√≥ria)</label>
      <div class="payment-details" data-option="pix" style="display:none;">
        <p><strong>Chave Pix:</strong> aleatoria-kadu-lanches@exemplo.com</p>
        <p>Use esta chave no app do seu banco.</p>
      </div>

      <label><input type="checkbox" name="payment-option" value="cartao_credito"> Cart√£o de cr√©dito</label>
      <div class="payment-details" data-option="cartao_credito" style="display:none;">
        <label>N√∫mero do cart√£o</label>
        <input type="text" id="cc-number" maxlength="19" placeholder="#### #### #### ####">
        <label>Nome impresso</label>
        <input type="text" id="cc-name" placeholder="Nome como no cart√£o">
        <label>Validade (MM/AA)</label>
        <input type="text" id="cc-exp" maxlength="5" placeholder="MM/AA">
        <label>CVV</label>
        <input type="text" id="cc-cvv" maxlength="4" placeholder="3 ou 4 d√≠gitos">
      </div>

      <label><input type="checkbox" name="payment-option" value="cartao_debito"> Cart√£o de d√©bito</label>
      <div class="payment-details" data-option="cartao_debito" style="display:none;">
        <label>N√∫mero do cart√£o</label>
        <input type="text" id="cd-number" maxlength="19" placeholder="#### #### #### ####">
        <label>Nome impresso</label>
        <input type="text" id="cd-name" placeholder="Nome como no cart√£o">
        <label>Validade (MM/AA)</label>
        <input type="text" id="cd-exp" maxlength="5" placeholder="MM/AA">
      </div>

      <label><input type="checkbox" name="payment-option" value="entrega"> Pagar na entrega</label>
      <div class="payment-details" data-option="entrega" style="display:none;">
        <label>Troco para (opcional)</label>
        <input type="number" id="troco" min="0" step="0.01" placeholder="Ex: 50,00">
      </div>

      <button type="submit">Salvar forma de pagamento</button>
    </form>
  </section>

  <script>
    // For√ßar sele√ß√£o √∫nica com checkbox (comportamento de r√°dio)
    const optionInputs = document.querySelectorAll('input[name="payment-option"]');
    optionInputs.forEach(input => {
      input.addEventListener('change', () => {
        if (input.checked) {
          optionInputs.forEach(other => {
            if (other !== input) other.checked = false;
          });
          showDetails(input.value);
        } else {
          hideDetails(input.value);
        }
      });
    });

    function showDetails(option) {
      document.querySelectorAll('.payment-details').forEach(div => {
        div.style.display = div.dataset.option === option ? 'block' : 'none';
      });
    }

    function hideDetails(option) {
      document.querySelectorAll('.payment-details').forEach(div => {
        if (div.dataset.option === option) div.style.display = 'none';
      });
    }

    // Pr√©-carregar escolha
    const saved = JSON.parse(localStorage.getItem('payment'));
    if (saved) {
      const toCheck = Array.from(optionInputs).find(i => i.value === saved.method);
      if (toCheck) {
        toCheck.checked = true;
        showDetails(saved.method);
      }
      if (saved.method === 'pix' && saved.pixKey) {
        // nada a preencher, apenas exibi√ß√£o
      }
      if (saved.method === 'cartao_credito' && saved.cardNumber) {
        document.getElementById('cc-number').value = saved.cardNumber;
        document.getElementById('cc-name').value = saved.cardName || '';
        document.getElementById('cc-exp').value = saved.cardExp || '';
        document.getElementById('cc-cvv').value = saved.cardCvv || '';
      }
      if (saved.method === 'cartao_debito' && saved.cardNumber) {
        document.getElementById('cd-number').value = saved.cardNumber;
        document.getElementById('cd-name').value = saved.cardName || '';
        document.getElementById('cd-exp').value = saved.cardExp || '';
      }
      if (saved.method === 'entrega' && saved.troco) {
        document.getElementById('troco').value = saved.troco;
      }
    }

    document.getElementById('back-home').addEventListener('click', () => {
      window.location.href = 'visual-lanche.html';
    });

    document.getElementById('payment-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const chosen = Array.from(optionInputs).find(i => i.checked);
      if (!chosen) {
        alert('Escolha uma forma de pagamento.');
        return;
      }
      const method = chosen.value;
      const data = { method };

      if (method === 'pix') {
        data.pixKey = 'aleatoria-kadu-lanches@exemplo.com';
      }

      if (method === 'cartao_credito') {
        const num = document.getElementById('cc-number').value.trim();
        const name = document.getElementById('cc-name').value.trim();
        const exp = document.getElementById('cc-exp').value.trim();
        const cvv = document.getElementById('cc-cvv').value.trim();
        if (!num || !name || !exp || !cvv) {
          alert('Preencha todos os dados do cart√£o de cr√©dito.');
          return;
        }
        data.cardNumber = num;
        data.cardName = name;
        data.cardExp = exp;
        data.cardCvv = cvv;
        data.cardLast4 = num.slice(-4);
      }

      if (method === 'cartao_debito') {
        const num = document.getElementById('cd-number').value.trim();
        const name = document.getElementById('cd-name').value.trim();
        const exp = document.getElementById('cd-exp').value.trim();
        if (!num || !name || !exp) {
          alert('Preencha todos os dados do cart√£o de d√©bito.');
          return;
        }
        data.cardNumber = num;
        data.cardName = name;
        data.cardExp = exp;
        data.cardLast4 = num.slice(-4);
      }

      if (method === 'entrega') {
        const troco = document.getElementById('troco').value;
        if (troco) data.troco = troco;
      }

      localStorage.setItem('payment', JSON.stringify(data));
      alert('Forma de pagamento salva.');
      window.location.href = 'visual-lanche.html';
    });
  </script>
</body>
</html>
